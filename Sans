--// This is a version of https://raw.githubusercontent.com/rinqedd/rblx/main/Libs/ESP%20Library specifically for Afterglow.

--// rinq#9949

local Player = game.Players.LocalPlayer

local ESPLibrary = {ESPInstances = {}}
local Instances = ESPLibrary["ESPInstances"]

local ESPHolder = Instance.new("Folder",game.CoreGui)
ESPHolder.Name = "ESPHolder"

function MakeBBGui(Parent,Name,Part)
    local BillboardGui = Instance.new("BillboardGui",Parent)
    BillboardGui.Name = Name
    BillboardGui.Adornee = Part
    BillboardGui.Size = UDim2.new(0, 100, 0, 150)
    BillboardGui.StudsOffset = Vector3.new(0, 2, 0)
    BillboardGui.AlwaysOnTop = true
    
    return BillboardGui
end

function MakeText(Parent,Text)
    local ESPText = Instance.new("TextLabel",Parent)
    ESPText.Size = UDim2.new(0, 100, 0, 100)
    ESPText.BorderSizePixel = 0
    ESPText.TextSize = 10
    ESPText.BackgroundTransparency = 1
    ESPText.TextColor3 = Color3.new(1,1,1)
    ESPText.TextStrokeColor3 = Color3.fromRGB(6, 6, 6)
    ESPText.TextStrokeTransparency = 0.7
    ESPText.Text = Text
    
    return ESPText
end

function MakeChams(Parent,Name,Model)
    local Highlight = Instance.new("Highlight",Parent)
    Highlight.Adornee = Model
    
    return Hightlight
end

function ESPLibrary:ItemESP(Model,Text,Chams,Studs)
    for _,Base in pairs(Model:GetChildren()) do
        if Base:IsA("BasePart") and Base.Transparency ~= 1 then
            Base.Transparency = 0
        end
    end
    local PosPart = Model:FindFirstChildWhichIsA("BasePart")
    if not Text then Text = "" end
    if not Chams then Chams = true end
    if not Studs then Studs = true end

    local Holder = Instance.new("Folder",ESPHolder)
    Holder.Name = (Model.Name.."Holder")
    
    if Text ~= "" then
        local BillboardGui = MakeBBGui(Holder,Model.Name.."TEXT",Model)
        local ESPText = MakeText(BillboardGui,Text)
        if Studs then
            ESPText.Text = Text.."\nDistance: "..tostring(math.floor((Player.Character.HumanoidRootPart.Position-PosPart.Position).magnitude))
            spawn(function()
                while wait(0.2) and ESPText do
                    if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
                        ESPText.Text = Text.."\nDistance: "..tostring(math.floor((Player.Character.HumanoidRootPart.Position-PosPart.Position).magnitude))
                    end
                end
            end)
        end
        ESPText.BackgroundTransparency = 1
        ESPText.TextColor3 = Color3.new(1,1,1)
        ESPText.TextStrokeColor3 = Color3.fromRGB(6, 6, 6)
        ESPText.TextStrokeTransparency = 0.7
    end
    
    if Chams then
        local Cham = MakeChams(Holder,Model.Name.."CHAMS",Model)
    end
    
    Model.Parent.ChildRemoved:Connect(function(Removed)
        if Model == Removed then
            Holder:Destroy()
            table.remove(Instances,table.find(Instances,Model))
        end
    end)
    
    table.insert(Instances,Model)
    Instances[Model] = Holder
end

function ESPLibrary:PlayerESP(Player,ShowName,Chams)
    if not ShowName then ShowName = true end
    if not Chams then Chams = true end

    local Character = Player.Character

    local Holder = Instance.new("Folder",ESPHolder)
    Holder.Name = Player.Name.."Holder"
    
    local BillboardGui = MakeBBGui(Holder,Player.Name.."TEXT",Character:FindFirstChild("Head"))
    local ESPText = MakeText(BillboardGui,"Name: "..Player.Name.."\nHealth: "..tostring(math.floor(Character.Health.Value)))
    
    Character.Health:GetPropertyChangedSignal("Value"):Connect(function()
        ESPText.Text = "Name: "..Player.Name.."\nHealth: "..tostring(math.floor(Character.Health.Value))
    end)
    
    if Chams then
        local Cham = MakeChams(Holder,Player.Name.."CHAMS",Character)
    end
    
    Character.Parent.ChildRemoved:Connect(function(Char)
        if Character == Char then
            Holder:Destroy()
            table.remove(Instances,table.find(Instances,Player))
        end
    end)
    
    table.insert(Instances,Player)
    Instances[Player] = Holder
end

function ESPLibrary:RemovePlayerESP(Player)
    for i,v in pairs(Instances) do
        if i == Player and string.find(v.Name,"Holder") then
            for _,c in pairs(ESPHolder:GetChildren()) do
                if v == c then
                    c:Destroy()
                end
            end
        end
    end
end

function ESPLibrary:RemoveItemESP(Model)
    for i,v in pairs(Instances) do
        if i == Model and string.find(v.Name,"Holder") then
            for _,c in pairs(ESPHolder:GetChildren()) do
                if v == c then
                    c:Destroy()
                    break
                end
            end
            
            table.remove(Instances,table.find(Instances,i))
        end
    end
end

function ESPLibrary:ClearESP()
    for i,v in pairs(ESPHolder:GetChildren()) do
        v:Destroy()
        table.clear(Instances)
    end
end

return ESPLibrary
